<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Docker Reference — Magec — Self-hosted Multi-Agent AI Platform</title>
  <meta name="description" content="Define multiple AI agents, chain them into workflows, connect tools. Voice, Telegram, webhooks, cron. Your server, your rules.">
  <meta name="theme-color" content="#1c1917">
  <link rel="icon" type="image/svg+xml" href="/img/logo.svg">
  <link rel="stylesheet" href="/css/style.css">
  <meta property="og:title" content="Docker Reference">
  <meta property="og:description" content="Define multiple AI agents, chain them into workflows, connect tools. Voice, Telegram, webhooks, cron. Your server, your rules.">
  <meta property="og:type" content="website">
</head>
<body>
  <nav class="nav scrolled">
  <div class="nav__inner">
    <a href="/" class="nav__logo">
      <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="ng" x1="0%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#f87171"/></linearGradient></defs>
        <circle cx="32" cy="32" r="26" fill="url(#ng)"/>
        <circle cx="20" cy="24" r="2" fill="white" opacity=".9"/><circle cx="26" cy="18" r="1.5" fill="white" opacity=".7"/>
        <circle cx="40" cy="22" r="1.8" fill="white" opacity=".8"/><circle cx="46" cy="30" r="1.2" fill="white" opacity=".6"/>
        <circle cx="38" cy="38" r="2" fill="white" opacity=".75"/><circle cx="24" cy="40" r="1.4" fill="white" opacity=".65"/>
      </svg>
      Magec
    </a>
    <button class="nav__toggle" aria-label="Toggle menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>
    <ul class="nav__links">
      
      <li><a href="/#how-it-works" class="nav__link">How it works</a></li>
      
      <li><a href="/#what" class="nav__link">Platform</a></li>
      
      <li><a href="/#use-cases" class="nav__link">Use cases</a></li>
      
      <li><a href="/#screenshots" class="nav__link">Screenshots</a></li>
      
      <li><a href="/docs/" class="nav__link">Docs</a></li>
      
      <li>
        <a href="https://github.com/achetronic/magec" class="nav__cta" target="_blank" rel="noopener">
          <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
          GitHub
        </a>
      </li>
    </ul>
  </div>
</nav>

  <main>
    
<div class="container">
  <div class="docs-layout">
    <aside class="docs-sidebar">
      
      
      <div class="docs-sidebar__group">
        <div class="docs-sidebar__label">Getting Started</div>
        
        <a href="/docs/install-docker/" class="docs-sidebar__link">Docker Quick Start</a>
        
        <a href="/docs/install-compose-local/" class="docs-sidebar__link">Docker Compose</a>
        
        <a href="/docs/install-binary/" class="docs-sidebar__link">Binary Install</a>
        
        <a href="/docs/configuration/" class="docs-sidebar__link">Configuration</a>
        
        <a href="/docs/docker/" class="docs-sidebar__link docs-sidebar__link--active">Docker Reference</a>
        
      </div>
      
      
      
      <div class="docs-sidebar__group">
        <div class="docs-sidebar__label">Security</div>
        
        <a href="/docs/admin-password/" class="docs-sidebar__link">Admin Password</a>
        
      </div>
      
      
      
      <div class="docs-sidebar__group">
        <div class="docs-sidebar__label">Core Concepts</div>
        
        <a href="/docs/agents/" class="docs-sidebar__link">Agents</a>
        
        <a href="/docs/flows/" class="docs-sidebar__link">Agentic Flows</a>
        
        <a href="/docs/backends/" class="docs-sidebar__link">AI Backends</a>
        
        <a href="/docs/memory/" class="docs-sidebar__link">Memory</a>
        
        <a href="/docs/mcp/" class="docs-sidebar__link">MCP Tools</a>
        
        <a href="/docs/secrets/" class="docs-sidebar__link">Secrets</a>
        
        <a href="/docs/commands/" class="docs-sidebar__link">Commands</a>
        
      </div>
      
      
      
      <div class="docs-sidebar__group">
        <div class="docs-sidebar__label">Clients</div>
        
        <a href="/docs/clients/" class="docs-sidebar__link">Overview</a>
        
        <a href="/docs/voice-ui/" class="docs-sidebar__link">Voice UI</a>
        
        <a href="/docs/telegram/" class="docs-sidebar__link">Telegram</a>
        
        <a href="/docs/webhooks/" class="docs-sidebar__link">Webhooks</a>
        
        <a href="/docs/cron/" class="docs-sidebar__link">Cron</a>
        
      </div>
      
      
      
      <div class="docs-sidebar__group">
        <div class="docs-sidebar__label">Reference</div>
        
        <a href="/docs/api/" class="docs-sidebar__link">API Reference</a>
        
        <a href="/docs/voice-system/" class="docs-sidebar__link">Voice System</a>
        
        <a href="/docs/secrets-advanced/" class="docs-sidebar__link">Advanced Secrets</a>
        
        <a href="/docs/screenshots/" class="docs-sidebar__link">Screenshots</a>
        
      </div>
      
      
    </aside>
    <div class="docs-content">
      <button class="docs-sidebar-toggle btn btn--ghost">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
        Navigation
      </button>
      <h1>Docker Reference</h1>
      <p>This page covers advanced Docker topics: the container architecture, Docker Compose file structure, GPU support, data persistence, customization, and common operations. For getting started with Docker, see the installation guides:</p>
<ul>
<li><a href="/docs/install-docker/">Docker Quick Start (OpenAI)</a> — single container, minimal setup</li>
<li><a href="/docs/install-compose-local/">Docker Compose — Local</a> — fully local, all services</li>
<li><a href="/docs/install-compose-cloud/">Docker Compose — Cloud</a> — cloud AI providers</li>
</ul>
<h2 id="container-architecture">Container architecture</h2>
<p>A full Magec deployment includes several containers working together:</p>
<table>
  <thead>
      <tr>
          <th>Container</th>
          <th>Purpose</th>
          <th>Always present</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>magec</strong></td>
          <td>The Magec server — API, Admin UI, Voice UI, agent runtime</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td><strong>redis</strong></td>
          <td>Session memory storage</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td><strong>postgres</strong></td>
          <td>Long-term memory storage (pgvector)</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td><strong>ollama</strong></td>
          <td>Local LLM and embeddings (Qwen 3, nomic-embed-text)</td>
          <td>Local mode only</td>
      </tr>
      <tr>
          <td><strong>ollama-setup</strong></td>
          <td>Downloads Ollama models on first start, then exits</td>
          <td>Local mode only</td>
      </tr>
      <tr>
          <td><strong>parakeet</strong></td>
          <td>Local speech-to-text (NVIDIA Parakeet)</td>
          <td>Local, Anthropic, Gemini</td>
      </tr>
      <tr>
          <td><strong>tts</strong></td>
          <td>Local text-to-speech (OpenAI Edge TTS)</td>
          <td>Local, Anthropic, Gemini</td>
      </tr>
  </tbody>
</table>
<p>In cloud modes (OpenAI, Anthropic, Gemini), some containers are replaced by cloud API calls. Redis and PostgreSQL always run locally because they store your data.</p>
<h2 id="docker-compose-files">Docker Compose files</h2>
<h2 id="docker-compose-file">Docker Compose file</h2>
<p>The install script generates a <code>docker-compose.yaml</code> with all services pre-configured for your deployment. GPU acceleration for Ollama is included when you enable NVIDIA support during the interactive setup.</p>
<h2 id="docker-image">Docker image</h2>
<p>The Magec Docker image (<code>ghcr.io/achetronic/magec</code>) is built with a multi-stage Dockerfile:</p>
<table>
  <thead>
      <tr>
          <th>Stage</th>
          <th>Base</th>
          <th>Purpose</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>frontend</code></td>
          <td><code>node:22-slim</code></td>
          <td>Builds Admin UI and Voice UI</td>
      </tr>
      <tr>
          <td><code>models</code></td>
          <td><code>golang:1.25-alpine</code></td>
          <td>Downloads auxiliary ONNX models from HuggingFace</td>
      </tr>
      <tr>
          <td><code>ffmpeg</code></td>
          <td><code>mwader/static-ffmpeg:7.1</code></td>
          <td>Provides static ffmpeg binary (~135MB)</td>
      </tr>
      <tr>
          <td><code>onnx</code></td>
          <td><code>debian:bookworm-slim</code></td>
          <td>Downloads ONNX Runtime shared library (arch-aware)</td>
      </tr>
      <tr>
          <td><code>builder</code></td>
          <td><code>golang:1.25</code></td>
          <td>Compiles Go binary with everything embedded</td>
      </tr>
      <tr>
          <td>Runtime</td>
          <td><code>gcr.io/distroless/cc-debian12</code></td>
          <td>Final image — binary + ffmpeg + ONNX Runtime</td>
      </tr>
  </tbody>
</table>
<p>The runtime image uses <strong>distroless</strong> — no shell, no package manager, minimal attack surface. The image is available for <code>linux/amd64</code> and <code>linux/arm64</code>.</p>
<h2 id="gpu-support">GPU support</h2>
<p>The interactive installer detects NVIDIA GPUs and offers to enable GPU acceleration for Ollama automatically. You can also enable it manually by editing <code>docker-compose.override.yaml</code>:</p>
<p>Requirements:</p>
<ul>
<li>An NVIDIA GPU</li>
<li><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">nvidia-container-toolkit</a> installed</li>
<li>Docker configured to use the NVIDIA runtime</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ollama</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">reservations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">devices</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l">nvidia</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">capabilities</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">gpu]</span><span class="w">
</span></span></span></code></pre></div><h2 id="data-persistence">Data persistence</h2>
<p>All persistent data is stored in Docker volumes:</p>
<table>
  <thead>
      <tr>
          <th>Volume</th>
          <th>Contains</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>magec_data</code></td>
          <td><code>store.json</code> (configuration), <code>conversations.json</code></td>
      </tr>
      <tr>
          <td><code>redis_data</code></td>
          <td>Session memory</td>
      </tr>
      <tr>
          <td><code>postgres_data</code></td>
          <td>Long-term memory (pgvector)</td>
      </tr>
      <tr>
          <td><code>ollama_data</code></td>
          <td>Downloaded AI models</td>
      </tr>
  </tbody>
</table>
<p>Data survives container restarts, image updates, and <code>docker compose down/up</code> cycles.</p>
<p>To back up, copy <code>store.json</code> from the <code>magec_data</code> volume. To start fresh:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose down -v    <span class="c1"># removes all volumes</span>
</span></span><span class="line"><span class="cl">docker compose up -d      <span class="c1"># fresh start</span>
</span></span></code></pre></div><h2 id="customizing-your-deployment">Customizing your deployment</h2>
<h3 id="adding-mcp-servers-as-containers">Adding MCP servers as containers</h3>
<p>You can extend the Docker Compose configuration to add MCP servers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hass-mcp</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">ghcr.io/achetronic/hass-mcp:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">HASS_URL=http://homeassistant:8123</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">HASS_TOKEN=${HASS_TOKEN}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8888:8080&#34;</span><span class="w">
</span></span></span></code></pre></div><p>Then add the MCP server in the Admin UI pointing at <code>http://hass-mcp:8080/sse</code>.</p>
<h3 id="changing-ports">Changing ports</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">magec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3000:8080&#34;</span><span class="w">   </span><span class="c"># Voice UI + User API on port 3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3001:8081&#34;</span><span class="w">   </span><span class="c"># Admin UI + Admin API on port 3001</span><span class="w">
</span></span></span></code></pre></div><h3 id="environment-variables">Environment variables</h3>
<p>All Magec configuration supports <code>${VAR}</code> substitution:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">magec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">OPENAI_API_KEY=${OPENAI_API_KEY}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">LOG_LEVEL=debug</span><span class="w">
</span></span></span></code></pre></div><h3 id="accessing-host-services">Accessing host services</h3>
<p>If your LLM or other services run on the Docker host (not in containers), use <code>host.docker.internal</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">magec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">extra_hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;host.docker.internal:host-gateway&#34;</span><span class="w">
</span></span></span></code></pre></div>


<div class="docs-callout docs-callout--info">
  On macOS and Windows, <code>host.docker.internal</code> works automatically. On Linux, you need the <code>extra_hosts</code> mapping above (or <code>--add-host=host.docker.internal:host-gateway</code> with <code>docker run</code>).
</div>

<h2 id="common-operations">Common operations</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> magec                                    <span class="c1"># your deployment directory</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Logs</span>
</span></span><span class="line"><span class="cl">docker compose logs -f                      <span class="c1"># all services</span>
</span></span><span class="line"><span class="cl">docker compose logs -f magec                <span class="c1"># Magec server only</span>
</span></span><span class="line"><span class="cl">docker compose logs -f ollama               <span class="c1"># Ollama only</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Lifecycle</span>
</span></span><span class="line"><span class="cl">docker compose down                         <span class="c1"># stop everything</span>
</span></span><span class="line"><span class="cl">docker compose up -d                        <span class="c1"># start everything</span>
</span></span><span class="line"><span class="cl">docker compose restart magec                <span class="c1"># restart Magec only</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Updates</span>
</span></span><span class="line"><span class="cl">docker compose pull                         <span class="c1"># pull latest images</span>
</span></span><span class="line"><span class="cl">docker compose up -d                        <span class="c1"># restart with new versions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Backup</span>
</span></span><span class="line"><span class="cl">docker compose cp magec:/app/data/store.json ./store-backup.json
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Reset</span>
</span></span><span class="line"><span class="cl">docker compose down -v                      <span class="c1"># stop and remove volumes</span>
</span></span><span class="line"><span class="cl">docker compose up -d                        <span class="c1"># fresh start</span>
</span></span></code></pre></div>


<div class="docs-callout docs-callout--info">
  When updating, <code>docker compose pull &amp;&amp; docker compose up -d</code> is all you need. Your configuration in <code>data/</code> persists across image updates.
</div>


    </div>
  </div>
</div>

  </main>
  <div id="lightbox" class="lightbox">
  <button class="lightbox__close" aria-label="Close">✕</button>
  <img id="lightbox-img" src="" alt="">
</div>

  <footer class="footer">
  <div class="container">
    <div class="footer__inner">
      <div class="footer__brand">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
          <defs><linearGradient id="fg" x1="0%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#f87171"/></linearGradient></defs>
          <circle cx="32" cy="32" r="26" fill="url(#fg)"/>
          <circle cx="20" cy="24" r="2" fill="white" opacity=".9"/><circle cx="40" cy="22" r="1.8" fill="white" opacity=".8"/>
          <circle cx="38" cy="38" r="2" fill="white" opacity=".75"/>
        </svg>
        Magec · Apache 2.0
      </div>
      <ul class="footer__links">
        <li><a href="https://github.com/achetronic/magec" target="_blank" rel="noopener">GitHub</a></li>
        <li><a href="/docs/">Docs</a></li>
        <li><a href="https://github.com/achetronic/magec/issues" target="_blank" rel="noopener">Issues</a></li>
      </ul>
    </div>
  </div>
</footer>

  <script type="module" src="/js/main.js"></script>
</body>
</html>
