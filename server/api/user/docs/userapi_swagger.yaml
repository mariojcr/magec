basePath: /api/v1
definitions:
  user.A2AAgentCard:
    properties:
      capabilities:
        $ref: '#/definitions/user.A2ACapabilities'
      defaultInputModes:
        example:
        - text/plain
        items:
          type: string
        type: array
      defaultOutputModes:
        example:
        - text/plain
        items:
          type: string
        type: array
      description:
        example: Smart home control agent with access to Home Assistant
        type: string
      name:
        example: Home Assistant
        type: string
      preferredTransport:
        example: JSONRPC
        type: string
      protocolVersion:
        example: 0.2.5
        type: string
      security:
        items:
          additionalProperties: {}
          type: object
        type: array
      securitySchemes:
        additionalProperties: {}
        type: object
      skills:
        items:
          $ref: '#/definitions/user.A2ASkill'
        type: array
      url:
        example: https://magec.example.com/api/v1/a2a/home-assistant
        type: string
      version:
        example: 1.0.0
        type: string
    type: object
  user.A2ACapabilities:
    properties:
      streaming:
        example: true
        type: boolean
    type: object
  user.A2AJSONRPCRequest:
    properties:
      id:
        example: 1
        type: integer
      jsonrpc:
        example: "2.0"
        type: string
      method:
        example: message/send
        type: string
      params: {}
    type: object
  user.A2AJSONRPCResponse:
    properties:
      error: {}
      id:
        example: 1
        type: integer
      jsonrpc:
        example: "2.0"
        type: string
      result: {}
    type: object
  user.A2ASkill:
    properties:
      description:
        example: I am a helpful smart home assistant. I can control lights and thermostats.
        type: string
      id:
        example: home-assistant
        type: string
      name:
        example: model
        type: string
      tags:
        example:
        - llm
        items:
          type: string
        type: array
    type: object
  user.AgentSummary:
    properties:
      agents:
        items:
          $ref: '#/definitions/user.AgentSummary'
        type: array
      id:
        example: magec
        type: string
      name:
        example: Magec
        type: string
      responseAgent:
        type: boolean
      type:
        example: agent
        type: string
    type: object
  user.ClientInfoResponse:
    properties:
      allowedAgents:
        items:
          $ref: '#/definitions/user.AgentSummary'
        type: array
      defaultAgent:
        example: magec
        type: string
      name:
        example: my-tablet
        type: string
      paired:
        example: true
        type: boolean
    type: object
  user.ErrorResponse:
    properties:
      error:
        example: resource not found
        type: string
    type: object
  user.SpeechRequest:
    properties:
      input:
        example: Hello world
        type: string
    type: object
  user.WebhookRequest:
    properties:
      prompt:
        example: Summarize today's news
        type: string
    type: object
  user.WebhookResponse:
    properties:
      error:
        example: ""
        type: string
      ok:
        example: true
        type: boolean
      response:
        example: Here is the summary...
        type: string
    type: object
host: localhost:8080
info:
  contact: {}
  description: User-facing API for Magec. Includes device pairing, voice proxies,
    and health checks.
  title: Magec User API
  version: "1.0"
paths:
  /a2a/.well-known/agent-card.json:
    get:
      description: Returns agent cards for all agents that have A2A enabled. Each
        card describes the agent's identity, capabilities, skills, and security requirements
        following the A2A protocol specification.
      parameters:
      - description: Filter by agent ID. When provided, returns a single card object
          instead of an array.
        example: home-assistant
        in: query
        name: agent
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: List of agent cards (or single card object when ?agent= is
            used)
          schema:
            items:
              $ref: '#/definitions/user.A2AAgentCard'
            type: array
      summary: List all A2A agent cards
      tags:
      - a2a
  /a2a/{agentID}:
    post:
      consumes:
      - application/json
      description: Sends a JSON-RPC 2.0 request to the specified agent. Supported
        methods include `message/send` and `message/stream`. The request must include
        a valid Bearer token.
      parameters:
      - description: Agent ID
        example: home-assistant
        in: path
        name: agentID
        required: true
        type: string
      - description: JSON-RPC 2.0 request
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/user.A2AJSONRPCRequest'
      produces:
      - application/json
      responses:
        "200":
          description: JSON-RPC 2.0 response
          schema:
            $ref: '#/definitions/user.A2AJSONRPCResponse'
        "401":
          description: Missing or invalid Bearer token
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "404":
          description: Agent not found or A2A not enabled
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Invoke A2A agent (JSON-RPC)
      tags:
      - a2a
  /a2a/{agentID}/.well-known/agent-card.json:
    get:
      description: Returns the A2A agent card for the specified agent. This is the
        per-agent discovery endpoint that A2A clients resolve relative to the agent's
        base URL.
      parameters:
      - description: Agent ID
        example: home-assistant
        in: path
        name: agentID
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Agent card
          schema:
            $ref: '#/definitions/user.A2AAgentCard'
        "404":
          description: Agent not found or A2A not enabled
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      summary: Get agent card by ID
      tags:
      - a2a
  /agent/apps/{app}/users/{user}/sessions:
    get:
      description: Returns all conversation sessions for the given app and user.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: List of sessions
          schema:
            items:
              type: object
            type: array
      security:
      - BearerAuth: []
      summary: List sessions
      tags:
      - sessions
    post:
      consumes:
      - application/json
      description: Creates a new session for the given app and user. Returns the session
        object with its generated ID.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Optional session configuration
        in: body
        name: body
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: Created session
          schema:
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Create session
      tags:
      - sessions
  /agent/apps/{app}/users/{user}/sessions/{session}:
    delete:
      description: Permanently deletes a conversation session and its history.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      responses:
        "200":
          description: Deleted
          schema:
            type: string
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Delete session
      tags:
      - sessions
    get:
      description: Returns the session details including message history.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Session details
          schema:
            type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get session
      tags:
      - sessions
    post:
      consumes:
      - application/json
      description: Updates session data (e.g. appending events or modifying state).
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      - description: Session update payload
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: Updated session
          schema:
            type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Update session
      tags:
      - sessions
  /agent/apps/{app}/users/{user}/sessions/{session}/artifacts:
    get:
      description: Returns all artifacts generated by agents during the given session.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: List of artifacts
          schema:
            items:
              type: object
            type: array
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: List artifacts
      tags:
      - artifacts
  /agent/apps/{app}/users/{user}/sessions/{session}/artifacts/{name}:
    delete:
      description: Permanently deletes the named artifact and all its versions from
        the session.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      - description: Artifact name
        in: path
        name: name
        required: true
        type: string
      responses:
        "200":
          description: Deleted
          schema:
            type: string
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Delete artifact
      tags:
      - artifacts
    get:
      description: Returns the latest version of the named artifact from the session.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      - description: Artifact name
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Artifact data
          schema:
            type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get artifact
      tags:
      - artifacts
  /agent/apps/{app}/users/{user}/sessions/{session}/artifacts/{name}/versions/{version}:
    get:
      description: Returns a specific version of the named artifact.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      - description: Artifact name
        in: path
        name: name
        required: true
        type: string
      - description: Version number
        in: path
        name: version
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Artifact data
          schema:
            type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get artifact version
      tags:
      - artifacts
  /agent/apps/{app}/users/{user}/sessions/{session}/events/{event}/graph:
    get:
      description: Returns the execution graph showing agent interactions for a specific
        event.
      parameters:
      - description: Agent app name (agent ID)
        in: path
        name: app
        required: true
        type: string
      - description: User ID
        in: path
        name: user
        required: true
        type: string
      - description: Session ID
        in: path
        name: session
        required: true
        type: string
      - description: Event ID
        in: path
        name: event
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Event graph
          schema:
            type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get event graph
      tags:
      - debug
  /agent/debug/trace/{event_id}:
    get:
      description: Returns the execution trace for a specific event, useful for debugging
        agent behavior.
      parameters:
      - description: Event ID
        in: path
        name: event_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Trace data
          schema:
            type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get event trace
      tags:
      - debug
  /agent/list-apps:
    get:
      description: Returns a list of all available agent app names.
      produces:
      - application/json
      responses:
        "200":
          description: List of app names
          schema:
            items:
              type: string
            type: array
      security:
      - BearerAuth: []
      summary: List agents
      tags:
      - agent
  /agent/run:
    post:
      consumes:
      - application/json
      description: Send a message to an agent and receive the full response. The app_name
        is the agent ID.
      parameters:
      - description: Run request with app_name, user_id, session_id, and new_message
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: Agent response
          schema:
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Run agent
      tags:
      - agent
  /agent/run_sse:
    post:
      consumes:
      - application/json
      description: Send a message to an agent and receive the response streamed as
        Server-Sent Events.
      parameters:
      - description: Run request with app_name, user_id, session_id, and new_message
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - text/event-stream
      responses:
        "200":
          description: SSE event stream
          schema:
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Run agent (SSE streaming)
      tags:
      - agent
  /client/info:
    get:
      description: Returns client pairing status, name, default agent, and allowed
        agents. Requires Bearer token via Authorization header.
      produces:
      - application/json
      responses:
        "200":
          description: Authenticated client info
          headers:
            X-Client-ID:
              description: Set by auth middleware
              type: string
          schema:
            $ref: '#/definitions/user.ClientInfoResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Client info
      tags:
      - client
  /health:
    get:
      description: Returns 200 if the server is healthy
      produces:
      - text/plain
      responses:
        "200":
          description: ok
          schema:
            type: string
      summary: Health check
      tags:
      - system
  /voice/{agentId}/speech:
    post:
      consumes:
      - application/json
      description: Proxies a TTS request to the speech backend configured for the
        given agent. Returns audio data.
      parameters:
      - description: Agent ID
        in: path
        name: agentId
        required: true
        type: string
      - description: Speech request with input text
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/user.SpeechRequest'
      produces:
      - application/octet-stream
      responses:
        "200":
          description: Audio data
          schema:
            type: file
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "502":
          description: Bad Gateway
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Text-to-Speech
      tags:
      - voice
  /voice/{agentId}/transcription:
    post:
      consumes:
      - multipart/form-data
      description: Proxies a transcription request to the STT backend configured for
        the given agent. Accepts multipart audio.
      parameters:
      - description: Agent ID
        in: path
        name: agentId
        required: true
        type: string
      - description: Audio file to transcribe
        in: formData
        name: file
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: Transcription result
          schema:
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "502":
          description: Bad Gateway
          schema:
            $ref: '#/definitions/user.ErrorResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/user.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Speech-to-Text
      tags:
      - voice
  /voice/events:
    get:
      description: WebSocket endpoint for real-time voice events including wake word
        detection and voice activity detection (VAD).
      responses:
        "101":
          description: Switching Protocols
          schema:
            type: string
      summary: Voice events WebSocket
      tags:
      - voice
  /webhooks/{id}:
    post:
      consumes:
      - application/json
      description: Fires a webhook client. For fixed-command webhooks, the command
        is executed as configured. For passthrough webhooks, the prompt must be provided
        in the request body. The client's token is required for authentication. The
        command runs against all agents in the client's allowedAgents list.
      parameters:
      - description: Webhook client ID
        in: path
        name: id
        required: true
        type: string
      - description: Request body (required for passthrough webhooks)
        in: body
        name: body
        schema:
          $ref: '#/definitions/user.WebhookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/user.WebhookResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/user.WebhookResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/user.WebhookResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/user.WebhookResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/user.WebhookResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/user.WebhookResponse'
      security:
      - BearerAuth: []
      summary: Execute webhook
      tags:
      - webhooks
schemes:
- http
securityDefinitions:
  BearerAuth:
    description: 'Enter your bearer token as: Bearer <token>'
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
